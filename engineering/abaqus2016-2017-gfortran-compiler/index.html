<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Using gfortran compiler for user subroutines in ABAQUS 2016/2017</title>
        <link rel="stylesheet" href="https://saiwal.github.io/theme/css/main.css" />
        <link href="https://saiwal.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Saiwal's Notes Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://saiwal.github.io/">Saiwal's Notes </a></h1>
                <nav><ul>
                    <li><a href="https://saiwal.github.io/category/academia.html">Academia</a></li>
                    <li class="active"><a href="https://saiwal.github.io/category/engineering.html">Engineering</a></li>
                    <li><a href="https://saiwal.github.io/category/misc.html">Misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://saiwal.github.io/engineering/abaqus2016-2017-gfortran-compiler/" rel="bookmark"
           title="Permalink to Using gfortran compiler for user subroutines in ABAQUS 2016/2017">Using gfortran compiler for user subroutines in ABAQUS 2016/2017</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-05-04T00:00:00+05:30">
                Published: Thu 04 May 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://saiwal.github.io/author/saiwal-krishna.html">Saiwal Krishna</a>
        </address>
<p>In <a href="https://saiwal.github.io/category/engineering.html">Engineering</a>.</p>
<p>tags: <a href="https://saiwal.github.io/tags/abaqus.html">abaqus</a> </p>
</footer><!-- /.post-info -->      <p>My previous post showed how to get gfortran running on ABAQUS 6.13 for compiling user subroutines. ABAQUS 2016/2017 have changed the way environment files are used.</p>
<p>ABAQUS uses intel fortran compiler by default for compiling user subroutines. However a free alternative 'gfortran' can also be used. Here the main steps are outlined for using free gfortran compiler in linux to compile user subroutines for ABAQUS. This has not been tested yet, however this should also work for ABAQUS 2016/2017 as the basic principle reamains the same.</p>

<ol>
<li>
<p>Make sure gfortran is installed. If not install it by running</p>
<div class="highlight"><pre><span></span> sudo apt-get install gfortran
</pre></div>
</li>
<li>
<p>Locate the lnx86_64.env file. Its located in the installation folder under  /usr/local/softs/Abaqus2017/DassaultSystemes/SimulationServices/V6R2017x/linux_a64/SMA/site/</p>
<p><strong>Note</strong> that there are dfferent environment files now which are imported in the main file <em>basic_v6.env</em></p>
</li>
<li>
<p>Rename it to ~lnx86_64.env. This will server as a backup file incase something goes wrong.</p>
</li>
<li>
<p>Change the following lines as shown below:</p>
<div class="highlight"><pre><span></span>fortCmd = "ifort"   # &amp;lt;-- Fortran compiler
</pre></div>
<p>should be changed to </p>
<div class="highlight"><pre><span></span>fortCmd = "gfortran"   # &amp;lt;-- Fortran compiler
</pre></div>
<p>and </p>
<div class="highlight"><pre><span></span>compile_fortran = [fortCmd,
       '-V',
       '-c', '-fPIC', '-auto', '-mP2OPT_hpo_vec_divbyzero=F', '-extend_source',
       '-fpp', '-WB', '-I%I']
</pre></div>
<p>should be changed to</p>
<div class="highlight"><pre><span></span>compile_fortran = (fortCmd + " -c -fPIC -I%I")
</pre></div>
<p>and,</p>
<div class="highlight"><pre><span></span>link_sl = [fortCmd,
       '-V',
       '-cxxlib', '-fPIC', '-threads', '-shared','-Wl,--add-needed',
       '%E', '-Wl,-soname,%U', '-o', '%U', '%F', '%A', '%L', '%B', '-parallel',
       '-Wl,-Bdynamic', '-shared-intel']
</pre></div>
<p>changed to</p>
<div class="highlight"><pre><span></span>link_sl = (fortCmd + 
   " -gcc-version=%i -fPIC -shared " + 
   "%E -Wl,-soname,%U -o %U %F %A %L %B -Wl,-Bdynamic " +
   " -lifport -lifcoremt")
</pre></div>
</li>
<li>
<p>Rest of the file remains the same.</p>
</li>
<li>
<p>Run the following command to verify:</p>
<div class="highlight"><pre><span></span>abaqus verify -user_std
</pre></div>
</li>
</ol>
<p>The following will confirm a working fortran compiler.</p>
<p><img alt="success" src="https://saiwal.github.io/images/success.png"/></p>
<p><strong>Note:</strong></p>
<p>replace the ifort "-extend" option with:</p>
<p>"-ffixed-line-length-none"</p>
<p>for those who do not pay attention to the F77 72 column limit. </p>
<p>(this helpful tip was received from <em>Ben Hantz</em>)</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://iitk.ac.in">Indian Institute of Technology Kanpur</a></li>
                            <li><a href="http://www.imechanica.org">iMechanica</a></li>
                            <li><a href="http://iitk.ac.in/ce">IITK CE</a></li>
                            <li><a href="http://solidmechanics.org/">Solid Mechanics</a></li>
                            <li><a href="http://ocw.mit.edu/courses/civil-and-environmental-engineering/">MIT OCW</a></li>
                            <li><a href="http://home.iitk.ac.in/~saiwal">my iitk homepage</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://saiwal.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="http://home.iitk.ac.in/~saiwal/feeds/all.atom.xml">RSS</a></li>
                            <li><a href="https://www.youtube.com/mrsaiwal">Youtube</a></li>
                            <li><a href="https://github.com/saiwal">Github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>